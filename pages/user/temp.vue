<style lang="less">
page {
	background-color: #f5f5f5;
}
.box-icon {
	width: 100upx;
	height: 100upx;
}
.hongdian {
	width: 20upx;
	height: 20upx;
	background-color: #e54d42;
	border-radius: 50%;
}
</style>

<template>
    <view class="content">
        <cu-custom bgColor="bg-white" :isBack="false">
            <block slot="content">
                <view class="text-bold">{{ title }}</view>
            </block>
        </cu-custom>
        <view class="padding-top-xs padding-bottom">
            <view class="padding-sm">
                <view class="padding-lr-sm padding-tb-sm bg-white text-df flex justify-between align-center round">
                    <view class="flex">
                        <view class="text-3E3E3E margin-right flex align-center">
                            <view class="w-xs h-xs round bg-red margin-right-sm"></view>
                            <view class="">订单最早到达时间</view>
                        </view>
                        <view class="text-black">01月30日 07:14</view>
                    </view>
                    <button class="cu-btn bg-red sm round">打卡</button>
                </view>
            </view>
            <view class="padding-lr-sm padding-tb-xs shadow-lg" v-for="(item, index) in paramData" :key="index" @tap="hrefSave(item, '/pages/article/messageDetails')">
                <view class="bg-white padding radius-df flex justify-between align-center">
                    <view class="box-icon icon1"></view>
                    <view class="margin-left flex-sub">
                        <view class="flex justify-between">
                            <view class="text-lg text-bold text-black">{{ item.title }}</view>
                            <view class="text-df text-gray-C1C1C1">{{ item.sendTime }}</view>
                        </view>
                        <view class="flex justify-between align-start margin-top-xs">
                            <view class="text-content">
                                <view class="">{{ item.msgContent }}</view>
                                <view class="text-red">点击查看</view>
                            </view>
                            <view class="hongdian margin-left" v-if="item.readFlag == 0"></view>
                        </view>
                    </view>
                </view>
            </view>
            <mixLoadMore :status="paramLoca.loadMoreStatus"></mixLoadMore>
        </view>
    </view>
</template>

<script>
import mixLoadMore from '@/components/mix-load-more/mix-load-more';
export default {
    components: { mixLoadMore },
    data() {
        return {
            title: '消息',
            paramForm: {
                pageNo: 1,
                pageSize: 10,
            },
            paramData: [],
            paramLoca: {
                loadMoreStatus: 0,
            },
        };
    },
    onLoad(e) {
        const that = this;
        that.getData(that, 1);
    },
    onShow() {},
    methods: {
        getData(that, page, type) {
            that.paramForm.pageNo = page != undefined ? page : 1;
            that.paramForm.userSystemId = that.getu('userSystemId');
            that.$tools.requests(that, that.api_getMessageList, that.paramForm, 'get', type).then(res => {
                const data = res.result.records;
                console.log(data);
                if (type == 'add') {
                    data.forEach(item => {
                        that.paramData.push(item);
                    });
                } else {
                    that.paramData = data;
                }
                if (data.length < 10) {
                    that.paramLoca.loadMoreStatus = 2;
                }
            });
        },
        onPullDownRefresh() {
            console.log('refresh');
            const that = this;
            that.getData(that);
        },
        onReachBottom() {
            console.log('onReachBottom');
            const that = this;
            that.paramForm.pageNo++;
            that.getData(that, that.paramForm.pageNo, 'add');
        },
    },
}
</script>
